***************
*** 159,165 ****
            'legacy' => 'eu_cookie_compliance_popup_info_consent_default',
            'new' => 'eu_cookie_compliance_popup_info',
          ];
-         $popup_info_template = $info_templates[$config->get('popup_info_template')];
          break;
  
        case 'opt_in':
--- 159,168 ----
            'legacy' => 'eu_cookie_compliance_popup_info_consent_default',
            'new' => 'eu_cookie_compliance_popup_info',
          ];
+         $templateValue = $config->get('popup_info_template');
+         if (isset($info_templates[$templateValue])) {
+           $popup_info_template = $info_templates[$templateValue];
+         }
          break;
  
        case 'opt_in':
***************
*** 228,237 ****
        $twig_service->disableDebug();
      }
  
-     $html_info = trim(Drupal::service('renderer')->renderRoot($html_info)->__toString());
-     $mobile_html_info = trim(Drupal::service('renderer')->renderRoot($mobile_html_info)->__toString());
-     $html_agreed = trim(Drupal::service('renderer')->renderRoot($html_agreed)->__toString());
-     $withdraw_markup = trim(Drupal::service('renderer')->renderRoot($withdraw_markup)->__toString());
  
      if ($was_debugging) {
        $twig_service->enableDebug();
--- 231,244 ----
        $twig_service->disableDebug();
      }
  
+     $html_info_rended = Drupal::service('renderer')->renderRoot($html_info);
+     $html_info = ($html_info_rended) ? trim($html_info_rended->__toString()) : "";
+     $mobile_html_info_rended = Drupal::service('renderer')->renderRoot($mobile_html_info);
+     $mobile_html_info = $mobile_html_info_rended ? trim($mobile_html_info_rended->__toString()) : "";
+     $html_agreed_rended = Drupal::service('renderer')->renderRoot($html_agreed);
+     $html_agreed = $html_agreed_rended ? trim($html_agreed_rended->__toString()) : "";
+     $withdraw_markup_rended = Drupal::service('renderer')->renderRoot($withdraw_markup);
+     $withdraw_markup = $withdraw_markup_rended ? trim($withdraw_markup_rended->__toString()) : "";
  
      if ($was_debugging) {
        $twig_service->enableDebug();
